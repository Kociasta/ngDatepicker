angular.module("jkuri.datepicker",[]).directive("ngDatepicker",["$document",function(s){"use strict";return{restrict:"EA",require:"?ngModel",scope:{},link:function(i,e,a,l){var n,t;t=a,(n=i).format=t.format||"YYYY-MM-DD",n.viewFormat=t.viewFormat||"Do MMMM YYYY",n.locale=t.locale||"en",n.firstWeekDaySunday=n.$eval(t.firstWeekDaySunday)||!1,n.placeholder=t.placeholder||"",i.calendarOpened=!1,i.days=[],i.dayNames=[],i.viewValue=null,i.dateValue=null,moment.locale(i.locale);var d=moment(),r=function(e){var a=e.endOf("month").date(),n=e.month(),t=e.year(),d=1,r=!0===i.firstWeekDaySunday?e.set("date",2).day():e.set("date",1).day();1!==r&&(d-=r-1),2==d&&(d=-5),i.dateValue=e.format("MMMM YYYY"),i.days=[];for(var l=d;l<=a;l+=1)0<l?i.days.push({day:l,month:n+1,year:t,enabled:!0}):i.days.push({day:null,month:null,year:null,enabled:!1})};!function(){for(var e=!0===i.firstWeekDaySunday?moment("2015-06-07"):moment("2015-06-01"),a=0;a<7;a+=1)i.dayNames.push(e.format("ddd")),e.add("1","d")}(),i.keypressed=function(e){if(13==e.keyCode){var a=moment(i.viewValue,i.viewFormat);l.$setViewValue(a.format(i.format)),i.viewValue=a.format(i.viewFormat),i.closeCalendar()}else if(27==e.keyCode){a=moment(l.$modelValue);i.viewValue=a.format(i.viewFormat),i.closeCalendar()}},i.showCalendar=function(){i.calendarOpened=!0,r(d)},i.closeCalendar=function(){i.calendarOpened=!1},i.prevYear=function(){d.subtract(1,"Y"),r(d)},i.prevMonth=function(){d.subtract(1,"M"),r(d)},i.nextMonth=function(){d.add(1,"M"),r(d)},i.nextYear=function(){d.add(1,"Y"),r(d)},i.selectDate=function(e,a){e.preventDefault();var n=moment(a.day+"."+a.month+"."+a.year,"DD.MM.YYYY");l.$setViewValue(n.format(i.format)),i.viewValue=n.format(i.viewFormat),i.closeCalendar()};var o=["ng-datepicker","ng-datepicker-input"];void 0!==a.id&&o.push(a.id),s.on("click",function(e){if(i.calendarOpened){var a,n=0;if(e.target){for(a=e.target;a;a=a.parentNode){var t=a.id,d=a.className;if(void 0!==t)for(n=0;n<o.length;n+=1)if(-1<t.indexOf(o[n])||-1<d.indexOf(o[n]))return}var r=moment(i.viewValue,i.viewFormat);l.$setViewValue(r.format(i.format)),i.viewValue=r.format(i.viewFormat),i.closeCalendar(),i.$apply()}}}),l.$render=function(){var e=l.$viewValue;void 0!==e&&(i.viewValue=moment(e).format(a.viewFormat),i.dateValue=e)}},template:'<div><input type="text" ng-focus="showCalendar()" ng-keydown="keypressed($event)" ng-model="viewValue" class="ng-datepicker-input" placeholder="{{ placeholder }}"></div><div class="ng-datepicker" ng-show="calendarOpened">  <div class="controls">    <div class="left">      <i class="fa fa-backward prev-year-btn" ng-click="prevYear()"></i>      <i class="fa fa-angle-left prev-month-btn" ng-click="prevMonth()"></i>    </div>    <span class="date" ng-bind="dateValue"></span>    <div class="right">      <i class="fa fa-angle-right next-month-btn" ng-click="nextMonth()"></i>      <i class="fa fa-forward next-year-btn" ng-click="nextYear()"></i>    </div>  </div>  <div class="day-names">    <span ng-repeat="dn in dayNames">      <span>{{ dn }}</span>    </span>  </div>  <div class="calendar">    <span ng-repeat="d in days">      <span class="day" ng-click="selectDate($event, d)" ng-class="{disabled: !d.enabled}">{{ d.day }}</span>    </span>  </div></div>'}}]);
